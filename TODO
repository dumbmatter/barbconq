# Major current tasks

UI Glitch
  Take a chariot that has already attacked this turn. Right click hover over enemy, and dotted line blinks off. stays off until you hover over another tile. why?
    map.pathFinding is called once before a right click, and twice after. if the second click comes before the 2 after ones, then it clears the path.
    DIAGNOSED PROBLEM: moveTowardsTarget should not be called if the unit can't actually move towards the target because an enemy is there
      this ties into another problem - pathFinding should route around enemies. but in that case, how can it show battle info when you right click hover on enemy? it will just show nothing, like the enemy is a peak
      POSSIBLE SOLUTION
        game.map.pathFinding should somehow not allow path finding on tile with enemy, except if it's right under the target
      QUICK FIX (done): check if movement happens naturally or if battle takes over before calling tryToMove

Combat
  right click hover
    check for this stuff in mapUI.drawPath, since it's needed only when a path is being drawn
      make a Combat.findBestDefender I can use for both units and groups
      needs to work even if attack can't happen this turn
    show predicted odds in hover box
    show path in red
  combat complexity
    http://www.civfanatics.com/civ4/strategy/combat_explained.php
    http://home.comcast.net/~proc/civ4/combat_calc.htm
    http://apolyton.net/showthread.php/140622-The-Civ-IV-Combat-System
    unit strength modifiers
      include in modifiedStrength formula
    first strikes
    retreat
    collateral damage
    experience points

unit tests for grouped units?
  karma/mocha/chai
  install all with npm
    need karma-mocha and karma-chai?
  how to either organize code so index.html is not needed, or include index.html as fixture?
  source maps for karma output
    https://github.com/karma-runner/karma/issues/594
      need to run tsc in preprocessor?
      or https://github.com/demerzel3/karma-sourcemap-loader
        tried it, but doesn't seem to work
        problem seems to be in source-map package. works with version 0.1.32, but not 0.1.33
          https://github.com/mozilla/source-map/issues/106
          NO, problem is not source-map. it's the input to source-map: karma's reporter.js isn't getting column numbers. why? not sure. maybe it'll work if i can make it error-free until real tests run?

fog of war
  states
    never seen yet: completely black
    saw before, but not currently in field of vision: terrain+improvements appear as last known, with shadow over it
      need to somehow cache last viewed tile state for every tile. copy of map, i guess
    in field of vision: visible

basic barb AI
  is there anyone i can attack with >25% chance of winning? if so, attack
  is there any move that will bring me closer/further from someone i am stronger/weaker than? if so, make it
  am i hurt? if so, fortify/rest
  otherwise, move randomly

# Minor current tasks

terrain effects
  movement
  defensive bonuses

keyboard shortcuts
  enter: if not end of turn, cycle through units
    should allow you to let unit continue on path

typescript live compile

"End turn early" green button and "end turn" red button, next to minimap
  if end turn early, make sure to move units on path towards targetCoords first!
    i have the same problem is i have a warrior/chariot group move towards target, have the "End" text flashing, separate so the chariot can still move, and then press enter
  is green/red always in sync with "begin next turn" blinker?
  add "shift+enter" shortcut for end turn early

right click to move
  right click on map -> drag off map -> drag back onto edge tile... path doesn't show up until drag onto another tile!
  needs to handle enemy units - can't cross

Make randomly generated map into a pangaea facsimile
  how do civ4 maps do it?

unit actions
  fortify
    defensive bonus
    healing
    top right indicator in unit icon
  sentry
  sleep/fortify difference?

unit types, to start with
  scout
  warrior
  archer
  chariot
  spearman
  axeman

unit promotions
  with "Blitz" promotion, never "attacked" set to True

unit design as weapons
  club, bow+arrow, spear, axe, horse
  monotone
  color represents civ
  how to do infinite stacking? how do civ 2/3/4/5 do it?
    show highest strength one on top, and "+ X more" in text below it

tile improvements? maybe roads and forts

minify assets
  have a "make barbconq" that puts all the right options in a ready-to-go barbconq folder

modularize css better
  use one of those newfangled preprocessors?

UI POLISH
  center minimap on its canvas when it is not the correct aspect ratio
  mapUI.goToCoords should be smooth
    draw a line between current coords and future coords. if it's long enough, discretize it and use setTimeout to move to each point along the way. uneven discretization can make it decelerate smoothly at the end

# Barbarian Conquest (barbconq)

Mode with just your units, barbarian units, and one barbarian city

Goal: Find and capture the barbarian capital!

Intro text:
  You have six types of units
  (show pictures and strength/movement stats, bonuses)
  Each turn, every one of your units can move (scouts and chariots get two moves, as long as the first one isn't onto a hill or forest). Move the active unit by right clicking with your mouse or by using the numpad on your keyboard.
  To fight a barbarian unit, move onto its tile (or wait for it to move onto yours). Each unit has a different base strength, and there are also bonuses depending on the types of units (e.g. spearmen are effective against chariots, archers are good at defending hills, etc.) and the terrain (hills and forests provide defensive bonuses).
  You can stack your units in the same tile. This provides better defense, since when a stack is attacked, the best defender against the attacking unit is chosen for battle. But if you keep your units together all the time, you won't be able to explore the island and find the barbarian capital quickly. And the barbarians are constantly training new units to fight you, especially in areas out of sight of your troops. So the longer it takes you to find the capital, the better defenses it will have.
  
somewhere: "From the makers of Basketball GM, a free single-player basketball simulation game"

map with just grassland, hills, and forest

place barb city randomly
  this forces exploration, which presents a tradeoff: staying together increases your strength, but allows barbs to grow in numbers before you find their city.

core gameplay concept ideas
  barbarians continually spawn, with increasing rate. goal is to stay alive as long as possible
    this doesn't work, because user will just stack on forest hill
  better idea: capture barbarian city
    keep some barbs fortified there and spawn others too
    to prevent people from stacking on forest hill to gain XP before attacking, make the goal to minimize the number of turns

easy/medium/hard
  barb city on hill or not
  xp you start with
  number of barbs
  xp barbs start with
  intelligence of barbs (like.. likelihood to stack, or go to city)

stats shown at end of game
  won or lost
  turns
  time spent
  barbs killed, by unit type
  your units, with promotions and killed/not killed
  combine to a score, compare user against a famous conqueror (like civ4 does with leaders)

monetization ideas
  reddit: "Barbarian Conquest, a minigame built on a partial web-based port of Civ4"
  Make desktop and cordova versions
  GCS
  adsense panel on the side of the screen. put intro/manual content in HTML as divs to hide/show in game, for both SEO and adsense

# Nice to have

should I make Units.Group.units and Tile.units lists of objects with ID keys, like game.units and game.groups?

Data
  keep it all in memory. write to indexeddb every turn

TypeScript
  Reevaluate all uses of "any"

# Future

animate unit movement
  any built-in canvas animation support? like hinted at in http://www.sitepoint.com/html5-canvas-tutorial-introduction/ or maybe http://bdadam.com/blog/panning-and-scrolling-background-images-using-the-canvas-element.html
  maybe add a transparent canvas on top and use that to animate movement before redrawing map

scroll wheel zoom by increasing TILE_SIZE
  but this won't scale the contents of the tiles...

# Far future

Friendly civs
  big problem: units of multiple civs can be on same tile. need a lot of stuff like this sprinkled throughout:
    .filter(function (unit) { return unit.owner === config.PLAYER_ID; });

Import civ4 maps

2d UI in HTML5
  read about how to do this, in general
  take inspiration from civ5 "strategic view"
  how to make it wrap at sides?
  libraries
    threejs?
      frustrum culling http://www.html5gamedevs.com/topic/930-best-practice-for-large-2d-world-in-threejs/
    pixi.js?
    IvanK?
      http://p.brm.sk/being/
    http://www.reddit.com/r/html5/comments/1zw8yl/canvas_newb_seeking_some_pointers_about_making_a/
    PROBABLY BEST:
      either threejs or raw webgl. try threejs first, looks easier

Allow lots of moddability, game modes
  look at what's in civ4